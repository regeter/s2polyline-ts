(()=>{"use strict";var t={367:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.deinterleaveBits2=e.deinterleaveBits1=e.interleaveBits=e.decodeZigZag32=e.encodeZigZag32=void 0;const n=r(452);function o(t){return 1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1)}function s(t){return t&=1431655765,t|=t>>>1,t&=858993459,t|=t>>>2,t&=252645135,t|=t>>>4,t&=16711935,65535&(t|=t>>>8)}e.encodeZigZag32=function(t){return t<<1^t>>31},e.decodeZigZag32=function(t){return t>>>1^-(1&t)},e.interleaveBits=function(t,e){const r=o(t)|o(e)<<1,s=o(t>>16)|o(e>>16)<<1;return new n.Long(r,s)},e.deinterleaveBits1=function(t){return s(t.lowBits)|s(t.highBits)<<16},e.deinterleaveBits2=function(t){return s(t.lowBits>>>1)|s(t.highBits>>>1)<<16}},529:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.LittleEndianInput=void 0;const n=r(452);e.LittleEndianInput=class{constructor(t){this.buffer=t,this.cursor=0;const e=new ArrayBuffer(8);this.float64View=new Float64Array(e),this.uint8View=new Uint8Array(e)}check(t){if(this.cursor+t>this.buffer.length)throw new Error("EOF")}readByte(){return this.check(1),this.buffer[this.cursor++]}readBytes(t){this.check(t);const e=[];for(let r=0;r<t;r++)e.push(this.buffer[this.cursor++]);return e}readInt(){this.check(4);let t=0;for(let e=0;e<4;e++)t|=this.buffer[this.cursor+e]<<8*e;return this.cursor+=4,t}readDouble(){this.check(8);for(let t=0;t<8;t++)this.uint8View[t]=this.buffer[this.cursor+t];return this.cursor+=8,this.float64View[0]}readVarint32(){return this.readVarint64().lowBits}readVarint64(){let t=0,e=0,r=0,o=0;do{t=this.readByte(),e|=(127&t)<<o,o+=7}while(o<32&&128&t);for(o>32&&(r|=(127&t)>>4),o=3;o<32&&128&t;o+=7)t=this.readByte(),r|=(127&t)<<o;if(t<128)return new n.Long(e,r);throw new Error("Malformed varint")}}},984:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.LittleEndianOutput=void 0,e.LittleEndianOutput=class{constructor(){this.capacity=32,this.buffer=new Uint8Array(this.capacity),this.cursor=0;const t=new ArrayBuffer(8);this.float64View=new Float64Array(t),this.uint8View=new Uint8Array(t)}check(t){const e=this.cursor+t;if(e<=this.capacity)return;for(;e>this.capacity;)this.capacity*=2;const r=new Uint8Array(this.capacity);r.set(this.buffer),this.buffer=r}writeByte(t){this.check(1),this.buffer[this.cursor++]=t}writeBytes(t){this.check(t.length),this.buffer.set(t,this.cursor),this.cursor+=t.length}writeInt(t){this.check(4),this.buffer[this.cursor++]=255&t,this.buffer[this.cursor++]=t>>8&255,this.buffer[this.cursor++]=t>>16&255,this.buffer[this.cursor++]=t>>24&255}writeDouble(t){this.float64View[0]=t,this.writeBytes(this.uint8View)}writeVarint32(t){for(;;){if(!(-128&t))return void this.writeByte(t);this.writeByte(127&t|128),t>>>=7}}writeVarint64(t){let e=t.lowBits,r=t.highBits;for(;0!==r||-128&e;)this.writeByte(127&e|128),e=e>>>7|r<<25,r>>>=7;this.writeByte(e)}getArray(){return this.buffer.subarray(0,this.cursor)}}},452:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Long=void 0;class r{constructor(t,e){this.lowBits=0|t,this.highBits=0|e}static fromBytes(t){const e=t[0]|t[1]<<8|t[2]<<16|t[3]<<24,n=t[4]|t[5]<<8|t[6]<<16|t[7]<<24;return new r(e,n)}toBytes(){const t=this.lowBits,e=this.highBits;return[255&t,t>>8&255,t>>16&255,t>>24&255,255&e,e>>8&255,e>>16&255,e>>24&255]}static fromUnsignedInt32(t){if(t<0||t>4294967295)throw new Error("Value is not an unsigned int32");return new r(t,0)}toUnsignedInt32(){if(0!==this.highBits)throw new Error("Not an unsigned int32");return this.lowBits>>>0}}e.Long=r},343:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MAX_LEVEL=e.NUM_FACES=void 0,e.NUM_FACES=6,e.MAX_LEVEL=30},659:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.S2LatLng=void 0;const n=r(145);class o{constructor(t,e){this.latRadians=t,this.lngRadians=e}static fromPoint(t){const e=Math.atan2(t.z+0,Math.sqrt(t.x*t.x+t.y*t.y)),r=Math.atan2(t.y+0,t.x+0);return new o(e,r)}toPoint(){const t=this.latRadians,e=this.lngRadians,r=Math.cos(t);return new n.S2Point(Math.cos(e)*r,Math.sin(e)*r,Math.sin(t))}static fromDegrees(t,e){const r=t*Math.PI/180,n=e*Math.PI/180;return new o(r,n)}latDegrees(){return 180/Math.PI*this.latRadians}lngDegrees(){return 180/Math.PI*this.lngRadians}}e.S2LatLng=o},145:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.S2Point=void 0;class r{constructor(t,e,r){this.x=t,this.y=e,this.z=r}normalize(){const t=this.x,e=this.y,n=this.z;let o=Math.sqrt(t*t+e*e+n*n);return 0!==o&&(o=1/o),new r(t*o,e*o,n*o)}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}static largestAbsComponent(t,e,r){const n=Math.abs(t),o=Math.abs(e),s=Math.abs(r);return n>o?n>s?0:2:o>s?1:2}encode(t){t.writeDouble(this.x),t.writeDouble(this.y),t.writeDouble(this.z)}static decode(t){const e=t.readDouble(),n=t.readDouble(),o=t.readDouble();return new r(e,n,o)}}e.S2Point=r},644:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TEST_ONLY=e.decodePointsCompressed=e.encodePointsCompressed=void 0;const n=r(367),o=r(452),s=r(343),i=r(145),c=r(521);class a{constructor(t,e){this.face=t,this.count=e}}class u{constructor(){this.faces=[]}addFace(t){const e=this.faces.length>0?this.faces[this.faces.length-1]:null;null!==e&&e.face===t?e.count++:this.faces.push(new a(t,1))}encode(t){for(const e of this.faces)t.writeVarint64(o.Long.fromUnsignedInt32(s.NUM_FACES*e.count+e.face))}decode(t,e){let r=0;for(;r<t;){const t=e.readVarint64().toUnsignedInt32(),n=new a(t%s.NUM_FACES,Math.floor(t/s.NUM_FACES));this.faces.push(n),r+=n.count}}getFaceIterator(){const t=this.faces;let e=0;if(0===t.length)return{next(){throw new Error("No such element")}};let r=t[e++],n=0;return{next:()=>(n<r.count?n++:(n=1,r=t[e++]),r.face)}}}class h{constructor(t){if(this.m=0,this.memory=new Array(h.N_MAX),t<h.N_MIN||t>h.N_MAX)throw new Error(`Unsupported N: ${t}`);this.n=t,this.reset()}encode(t){for(let e=0;e<this.m;e++){const r=t-this.memory[e];this.memory[e]=t,t=r}return this.m<this.n&&(this.memory[this.m++]=t),t}decode(t){this.m<this.n&&this.m++;for(let e=this.m-1;e>=0;e--)this.memory[e]+=t,t=this.memory[e];return t}reset(){for(let t=0;t<this.n;t++)this.memory[t]=0;this.m=0}}function l(t,e){return(t=Math.min(t,c.MAX_SITI-1))>>>s.MAX_LEVEL+1-e}function d(t,e){return(t+.5)/(1<<e)}function f(t,e,r,n){return(0,c.faceUvToXyz)(t,(0,c.stToUV)(d(e,n)),(0,c.stToUV)(d(r,n))).normalize()}h.N_MIN=0,h.N_MAX=10,e.encodePointsCompressed=function(t,e,r){const o=new u,s=[],i=[],a=[];for(let r=0;r<t.length;r++){const n=(0,c.xyzToFaceSiTi)(t[r]);o.addFace(n.face),s.push(l(n.si,e)),i.push(l(n.ti,e)),(0,c.levelIfCenter)(n,t[r])!==e&&a.push(r)}o.encode(r);const d=new h(2),f=new h(2);for(let t=0;t<s.length;t++){const o=d.encode(s[t]),c=f.encode(i[t]);if(0===t){const t=(0,n.interleaveBits)(o,c).toBytes(),s=2*Math.floor((e+7)/8);t.splice(s),r.writeBytes(t)}else{const t=(0,n.encodeZigZag32)(o),e=(0,n.encodeZigZag32)(c),s=(0,n.interleaveBits)(t,e);r.writeVarint64(s)}}r.writeVarint32(a.length);for(const e of a)r.writeVarint32(e),t[e].encode(r)},e.decodePointsCompressed=function(t,e,r){const s=[],c=new u;c.decode(t,r);const a=c.getFaceIterator(),l=new h(2),d=new h(2);for(let i=0;i<t;i++){let t,c;if(0===i){const s=2*Math.floor((e+7)/8),i=r.readBytes(s);for(;i.length<8;)i.push(0);const a=o.Long.fromBytes(i);t=l.decode((0,n.deinterleaveBits1)(a)),c=d.decode((0,n.deinterleaveBits2)(a))}else{const e=r.readVarint64();t=l.decode((0,n.decodeZigZag32)((0,n.deinterleaveBits1)(e))),c=d.decode((0,n.decodeZigZag32)((0,n.deinterleaveBits2)(e)))}const u=a.next();s.push(f(u,t,c,e))}const y=r.readVarint32();if(y>t)throw new Error("Number of off-center points is greater than total amount of points.");for(let t=0;t<y;t++){const t=r.readVarint32(),e=r.readDouble(),n=r.readDouble(),o=r.readDouble();s[t]=new i.S2Point(e,n,o)}return s},e.TEST_ONLY={NthDerivativeCoder:h}},771:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.S2Polyline=void 0;const n=r(529),o=r(984),s=r(343),i=r(145),c=r(644),a=r(521);class u{constructor(t){this.vertices=t}getBestSnapLevel(){const t=Array.from({length:s.MAX_LEVEL+1}).fill(0);for(const e of this.vertices){const r=(0,a.xyzToFaceSiTi)(e),n=(0,a.levelIfCenter)(r,e);n>=0&&t[n]++}let e=0;for(let r=1;r<t.length;r++)t[r]>t[e]&&(e=r);return 0===t[e]&&this.vertices.length>0?-1:e}encodeCompact(){const t=0===this.vertices.length?s.MAX_LEVEL:this.getBestSnapLevel(),e=new o.LittleEndianOutput;return-1===t?this.encodeUncompressed(e):this.encodeCompressed(t,e),e.getArray()}encodeUncompressed(t){t.writeByte(1),t.writeInt(this.vertices.length);for(const e of this.vertices)e.encode(t)}encodeCompressed(t,e){e.writeByte(2),e.writeByte(t),e.writeVarint32(this.vertices.length),(0,c.encodePointsCompressed)(this.vertices,t,e)}static decode(t){const e=new n.LittleEndianInput(t),r=e.readByte();if(1===r)return u.decodeLossless(e);if(2===r)return u.decodeCompressed(e);throw new Error(`Unsupported S2Polyline encoding version ${r}`)}static decodeLossless(t){const e=[],r=t.readInt();for(let n=0;n<r;n++)e.push(i.S2Point.decode(t));return new u(e)}static decodeCompressed(t){const e=t.readByte();if(e>s.MAX_LEVEL)throw new Error(`Invalid level ${e}`);const r=t.readVarint32(),n=(0,c.decodePointsCompressed)(r,e,t);return new u(n)}}e.S2Polyline=u},521:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.levelIfCenter=e.xyzToFaceSiTi=e.faceSiTiToXyz=e.faceUvToXyz=e.stToUV=e.MAX_SITI=void 0;const n=r(343),o=r(145);function s(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))}function i(t){return 1/e.MAX_SITI*t}e.MAX_SITI=Math.pow(2,n.MAX_LEVEL+1),e.stToUV=s;const c=[{uvToX:(t,e)=>1,uvToY:(t,e)=>t,uvToZ:(t,e)=>e},{uvToX:(t,e)=>-t,uvToY:(t,e)=>1,uvToZ:(t,e)=>e},{uvToX:(t,e)=>-t,uvToY:(t,e)=>-e,uvToZ:(t,e)=>1},{uvToX:(t,e)=>-1,uvToY:(t,e)=>-e,uvToZ:(t,e)=>-t},{uvToX:(t,e)=>e,uvToY:(t,e)=>-1,uvToZ:(t,e)=>-t},{uvToX:(t,e)=>e,uvToY:(t,e)=>t,uvToZ:(t,e)=>-1}];function a(t,e,r){const n=function(t){return c[Math.min(5,t)]}(t);return new o.S2Point(n.uvToX(e,r),n.uvToY(e,r),n.uvToZ(e,r))}function u(t,e,r){return a(t,s(i(e)),s(i(r)))}e.faceUvToXyz=a,e.faceSiTiToXyz=u;const h=[{xyzToU:(t,e,r)=>e/t,xyzToV:(t,e,r)=>r/t},{xyzToU:(t,e,r)=>-t/e,xyzToV:(t,e,r)=>r/e},{xyzToU:(t,e,r)=>-t/r,xyzToV:(t,e,r)=>-e/r},{xyzToU:(t,e,r)=>r/t,xyzToV:(t,e,r)=>e/t},{xyzToU:(t,e,r)=>r/e,xyzToV:(t,e,r)=>-t/e},{xyzToU:(t,e,r)=>-e/r,xyzToV:(t,e,r)=>-t/r}];function l(t){return t>=0?.5*Math.sqrt(1+3*t):1-.5*Math.sqrt(1-3*t)}function d(t){return Math.round(t*e.MAX_SITI)}class f{constructor(t,e,r){this.face=t,this.si=e,this.ti=r}}function y(t){const e=function(t){let e=(t&-t)-1;return e-=e>>1&1431655765,e=(858993459&e)+(e>>2&858993459),e=e+(e>>4)&252645135,e+=e>>8,e+=e>>16,e&=63,63&e}(t);return n.MAX_LEVEL-Math.min(e,31)}e.xyzToFaceSiTi=function(t){const e=function(t){const e=t.x,r=t.y,n=t.z;switch(o.S2Point.largestAbsComponent(e,r,n)){case 0:return e<0?3:0;case 1:return r<0?4:1;default:return n<0?5:2}}(t),r=h[e],n=r.xyzToU(t.x,t.y,t.z),s=r.xyzToV(t.x,t.y,t.z),i=d(l(n)),c=d(l(s));return new f(e,i,c)},e.levelIfCenter=function(t,e){const r=y(t.si);if(r<0||r!==y(t.ti))return-1;{const n=u(t.face,t.si,t.ti).normalize();return e.equals(n)?r:-1}}}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var s=e[n]={exports:{}};return t[n](s,s.exports,r),s.exports}(()=>{const t=r(659),e=r(771);const n=document.getElementById("decode"),o=document.getElementById("s2polyline"),s=document.getElementById("result");n&&(n.onclick=()=>{let r;try{r=function(r){const n=function(t){const e=atob(t),r=new Uint8Array(e.length);for(let t=0;t<e.length;t++)r[t]=e.charCodeAt(t);return r}(r.replace(/-/g,"+").replace(/_/g,"/")),o=e.S2Polyline.decode(n),s=[];for(const e of o.vertices)s.push(t.S2LatLng.fromPoint(e));return s}(o.value)}catch(t){return alert(t),void console.error(t)}let n="";n+=`Number of decoded vertices: ${r.length}\n`;for(let t=0;t<r.length;t++){const e=r[t];n+=`${t}: ${e.latDegrees()}, ${e.lngDegrees()}\n`}s.textContent=n})})()})();